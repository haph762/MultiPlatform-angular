"use strict";(self.webpackChunkcoreui_free_angular_admin_template=self.webpackChunkcoreui_free_angular_admin_template||[]).push([[314],{6314:(A,u,s)=>{s.r(u),s.d(u,{ChatsModule:()=>U});var a=s(4006),l=s(6895),d=s(5861),m=s(3429),c=s(2731),t=s(4650),h=s(2340),_=s(6185);let C=(()=>{class e{constructor(n){this.store=n}getData(){const n=(0,c.hJ)(h.db,"chats");return(0,c.IO)(n,(0,c.Xo)("createdAt","asc"))}addMes(n){this.store.collection("chats").doc().set({user:{_id:n.idUser,avatar:n.avatar},createdAt:n.createdAt,text:n.text,to:n.to})}getUser(n){return(0,d.Z)(function*(){const o=(0,c.hJ)(h.db,"users"),r=(0,c.IO)(o,(0,c.ar)("email","!=",`${n}`),(0,c.b9)(8));return yield(0,c.PL)(r)})()}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(_.ST))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const f=function(e){return{"user-is-check":e}};function M(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",1)(1,"div",5),t.NdJ("click",function(){const g=t.CHM(n).$implicit,E=t.oxw();return t.KtG(E.startChat(g))}),t._UZ(2,"img",6),t.TgZ(3,"div",7)(4,"h3"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()()()()}if(2&e){const n=i.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(3,f,o.userClicked===n.email)),t.xp6(4),t.Oqu(n.displayName),t.xp6(2),t.Oqu(n.email)}}let O=(()=>{class e{constructor(n){this.chatService=n,this.userList=[],this.userEmailCurrent="",this.userClick=new t.vpe,this.userClicked=""}ngOnInit(){this.getDataUsers()}getDataUsers(){this.chatService.getUser(this.userEmailCurrent).then(n=>{let o=[];n.forEach(r=>{o.push(r.data())}),this.userList=o,this.userClick.emit(o[0].email??""),this.userClicked=o[0].email??""}).catch(n=>console.log(n))}startChat(n){this.userClick.emit(n.email??""),this.userClicked=n.email??""}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(C))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-list-user"]],inputs:{userEmailCurrent:"userEmailCurrent"},outputs:{userClick:"userClick"},decls:6,vars:1,consts:[[1,"container"],[1,"row"],[1,"col"],[1,"list-user"],["class","row",4,"ngFor","ngForOf"],[1,"col","user",3,"ngClass","click"],["src","../../../../assets/images/mycv/profile-img.jpg","alt","",1,"user-img"],[1,"user-info"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4,"List User"),t.qZA()()(),t.YNc(5,M,8,5,"div",4),t.qZA()),2&n&&(t.xp6(5),t.Q6J("ngForOf",o.userList))},dependencies:[l.mk,l.sg],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;box-shadow:3px 7px 10px gray;border-radius:5px}.container[_ngcontent-%COMP%]   .list-user[_ngcontent-%COMP%]{text-align:center;height:50px;margin:auto}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:70px;border-bottom:1px gray solid;width:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;padding:1rem}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{cursor:pointer}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .user-img[_ngcontent-%COMP%]{width:50px;border-radius:50%}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{align-self:center;margin-left:.5rem;display:inline-block;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:green;margin:auto}.container[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#000;margin:auto}.container[_ngcontent-%COMP%]   .user-is-check[_ngcontent-%COMP%]{background-color:#aeadad}"]}),e})();const x=["scrollMe"];function P(e,i){if(1&e&&(t.TgZ(0,"div",24)(1,"div",25)(2,"div",26),t._UZ(3,"img",27),t.TgZ(4,"div",28),t._uU(5),t.qZA()(),t.TgZ(6,"div",29)(7,"p",30),t._uU(8),t.qZA()()()()),2&e){const n=t.oxw().$implicit;t.xp6(3),t.s9C("src",n.user.avatar,t.LSH),t.xp6(2),t.hij(" ",n.createdAt," "),t.xp6(3),t.Oqu(n.text)}}function v(e,i){if(1&e&&(t.TgZ(0,"div",31)(1,"div",32)(2,"div",29)(3,"p",30),t._uU(4),t.qZA()(),t.TgZ(5,"div",26),t._UZ(6,"img",27),t.TgZ(7,"div",28),t._uU(8),t.qZA()()()()),2&e){const n=t.oxw().$implicit;t.xp6(4),t.Oqu(n.text),t.xp6(2),t.s9C("src",n.user.avatar,t.LSH),t.xp6(2),t.hij(" ",n.createdAt," ")}}function w(e,i){if(1&e&&(t.TgZ(0,"div",21),t.YNc(1,P,9,3,"div",22),t.YNc(2,v,9,3,"div",23),t.qZA()),2&e){const n=i.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",n.user._id!==o.userEmailCurrent),t.xp6(1),t.Q6J("ngIf",n.user._id===o.userEmailCurrent)}}function y(e,i){1&e&&(t.ynx(0,null,33),t.TgZ(2,"div",34)(3,"p"),t._uU(4,"Start a conversation..."),t.qZA()(),t.BQk())}let Z=(()=>{class e{constructor(n,o){this.chatService=n,this.changeDetector=o,this.currentUser=localStorage.getItem(m.o.USER_FIREBASE),this.userEmailCurrent="",this.userEmailClient="User",this.chatsUser=[],this.chatsUserTmp=[],this.newChat={},this.unsubscribe={},this.myScrollContainer={};let r=this.currentUser?JSON.parse(this.currentUser):"";this.userEmailCurrent=r?.email}ngOnInit(){this.scrollToBottom()}getData(){this.unsubscribe=(0,c.cf)(this.chatService.getData(),n=>{let o=[];n.forEach(r=>{o.push(r.data())}),this.chatsUserTmp=o,this.chatsUser=[],this.chatsUserTmp.forEach(r=>{r.createdAt=new Date(1e3*r.createdAt.seconds).toLocaleTimeString(),(r.user._id===this.userEmailClient||r.user._id===this.userEmailCurrent)&&(r.to===this.userEmailClient||r.to===this.userEmailCurrent)&&this.chatsUser.push(r)})})}addMes(){var n=this;return(0,d.Z)(function*(){n.newChat.idUser=n.userEmailCurrent,n.newChat.to=n.userEmailClient,n.newChat.avatar="https://i.pravatar.cc/300",n.newChat.createdAt=new Date,yield n.chatService.addMes(n.newChat),n.newChat={},n.getData()})()}ngAfterViewChecked(){this.changeDetector.detectChanges(),this.scrollToBottom()}scrollToBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch{}}userClickParent(n){this.userEmailClient=n,this.getData()}ngOnDestroy(){this.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(C),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-chats"]],viewQuery:function(n,o){if(1&n&&t.Gf(x,5),2&n){let r;t.iGM(r=t.CRH())&&(o.myScrollContainer=r.first)}},decls:23,vars:6,consts:[[1,"container"],[1,"",2,"min-width","600px"],[1,"row"],[1,"col-2"],[3,"userEmailCurrent","userClick"],[1,"col-10"],[1,"chat-info"],["src","../../../assets/images/mycv/profile-img.jpg",1,"avatar-info"],[1,"user-info"],[1,"user-info-name"],[1,"user-info-last"],[1,"scorll"],["scrollMe",""],["class","chat-container",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"chat-send"],["autocomplete","off",1,"chat-send-form",3,"submit"],["type","text","name","text","id","text","placeholder","Message...",3,"ngModel","ngModelChange"],["type","submit",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","width","46","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-send-fill"],["d","M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"],[1,"chat-container"],["class","left",4,"ngIf"],["class","right",4,"ngIf"],[1,"left"],[1,"other-users"],[1,"avatar-time"],[1,"avtar",3,"src"],[1,"time"],[1,"message"],[1,"message-text"],[1,"right"],[1,"users"],["notResult",""],[1,"notResult"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"app-list-user",4),t.NdJ("userClick",function(g){return o.userClickParent(g)}),t.qZA()(),t.TgZ(5,"div",5)(6,"div",6),t._UZ(7,"img",7),t.TgZ(8,"div",8)(9,"h2",9),t._uU(10),t.qZA(),t.TgZ(11,"p",10),t._uU(12,"Last seen: 2 hours ago"),t.qZA()()(),t.TgZ(13,"div",11,12),t.YNc(15,w,3,2,"div",13),t.qZA(),t.YNc(16,y,5,0,"ng-container",14),t.TgZ(17,"div",15)(18,"form",16),t.NdJ("submit",function(){return o.addMes()}),t.TgZ(19,"input",17),t.NdJ("ngModelChange",function(g){return o.newChat.text=g}),t.qZA(),t.TgZ(20,"button",18),t.O4$(),t.TgZ(21,"svg",19),t._UZ(22,"path",20),t.qZA()()()()()()()()),2&n&&(t.xp6(4),t.Q6J("userEmailCurrent",o.userEmailCurrent),t.xp6(6),t.Oqu(o.userEmailClient),t.xp6(5),t.Q6J("ngForOf",o.chatsUser),t.xp6(1),t.Q6J("ngIf",o.chatsUser.length<=0),t.xp6(3),t.Q6J("ngModel",o.newChat.text),t.xp6(1),t.Q6J("disabled",!o.newChat.text))},dependencies:[l.sg,l.O5,a._Y,a.Fj,a.JJ,a.JL,a.On,a.F,O],styles:[".chat-info[_ngcontent-%COMP%]{background-color:#fff;height:80px;display:flex;flex-direction:row;align-items:center;padding:5px;border-bottom:1px gray solid}.chat-info[_ngcontent-%COMP%]   .avatar-info[_ngcontent-%COMP%]{width:60px;border-radius:50%}.chat-info[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{margin-left:15px;align-self:flex-start;position:relative;width:100%}.chat-info[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-info-name[_ngcontent-%COMP%]{color:green;position:absolute;top:10px}.chat-info[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-info-last[_ngcontent-%COMP%]{position:absolute;top:50px}.scorll[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{background-color:#aeadad;min-height:100px;padding-right:5px;padding-left:5px;display:flex;flex-direction:column}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{width:45%}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .other-users[_ngcontent-%COMP%]{padding-top:5px;display:flex;flex-direction:row;position:relative}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .other-users[_ngcontent-%COMP%]   .avatar-time[_ngcontent-%COMP%]{margin-top:20px}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .other-users[_ngcontent-%COMP%]   .avatar-time[_ngcontent-%COMP%]   .avtar[_ngcontent-%COMP%]{width:50px;border-radius:50%}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .other-users[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{position:absolute;left:60px;bottom:20px;top:5px;width:100%;background-color:#fff;flex:1;border-radius:9px 9px 9px 0;min-height:50px;overflow-y:scroll}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .other-users[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{padding:10px}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:45%;align-self:flex-end}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .users[_ngcontent-%COMP%]{padding-top:5px;display:flex;flex-direction:row-reverse;position:relative}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .users[_ngcontent-%COMP%]   .avatar-time[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;align-items:flex-end}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .users[_ngcontent-%COMP%]   .avatar-time[_ngcontent-%COMP%]   .avtar[_ngcontent-%COMP%]{width:50px;border-radius:50%}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .users[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{position:absolute;right:60px;bottom:20px;top:5px;width:100%;background-color:#fff;flex:1;border-radius:9px 9px 0;min-height:50px;overflow-y:scroll}.scorll[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .users[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{padding:10px}.notResult[_ngcontent-%COMP%]{font-size:32px;height:100px;display:flex;flex-direction:row;justify-content:center;align-items:center;border-left:1px gray solid;border-right:1px gray solid;color:green}.chat-send[_ngcontent-%COMP%]{background-color:#fff;width:100%;padding-left:5px}.chat-send[_ngcontent-%COMP%]   .chat-send-form[_ngcontent-%COMP%]{display:flex;flex-direction:row}.chat-send[_ngcontent-%COMP%]   .chat-send-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:40px;border:none;outline:none}.chat-send[_ngcontent-%COMP%]   .chat-send-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#d2d2d2;border:none}.chat-send[_ngcontent-%COMP%]   .chat-send-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .bi-send-fill[_ngcontent-%COMP%]{color:green}"]}),e})();var p=s(6806);const b=[{path:"",component:Z,data:{title:"chat"}}];let T=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[p.Bz.forChild(b),p.Bz]}),e})(),U=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[l.ez,T,a.u5]}),e})()}}]);